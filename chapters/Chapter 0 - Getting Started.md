# Chapter 0 - Getting Started
First things first, we need to install the dependencies for the application.
We're using the `bundler` gem to manage the Ruby gems our app depends on. Dependencies are defined in the `Gemfile`.
To do this, we run:

```bash
bundle install
```

Bundler also looks for a file called `Gemfile.lock`. This file is automatically generated, and contains the versions
of the gems that need to be installed. This helps to ensure that the same versions are installed for everyone.

## Preparing the Database
Before we can start development, we need to prepare the database.
Rails provides tasks that manage our database for us, which we need to invoke before we start:

```bash
rails db:create db:migrate db:seed
```

This line runs 3 different tasks in sequence:
 - `db:create` creates databases in Postgres for both the development and test environments.
 - `db:migrate` runs database migrations (found under `db/migrate`) that create tables, modify the schema, etc.
 - `db:seed` runs the code in `db/seeds.rb` which should populate our database which initial data.

## Running the Rails Server
To start the our server, we run the following command:

```bash
rails server
```

Alternatively, we can also use its shortened form:

```bash
rails s
```

Once the server starts, it's available at http://localhost:3000/.

## Running the Rails Console
During development, we run an interactive console in our app's environment.
To start the rails console:

```bash
rails console
```

Alternatively, we can also use its shortened form:

```bash
rails c
```

Once the console is ready, we can run whatever Ruby code we want in the context of our app.
For example, if we wanted to see all the users in our database, we can use:

```ruby
User.all
```

To improve readability, we use a gem called `awesome_print`, which can be called using `ap`.
To view that same list of users in a more readable way:

```ruby
ap User.all
```

To close the rails console, we can use `quit` or `exit`.

## Getting Familiar with Rails
Before we really start writing our own code, lets get familiar with some of the common functions in Rails.

### Models
Models are also used to retrieve records from, and also to create and edit records in the database.
Each instance of a model represents a single row that exists in the corresponding database table.

In the starter code, we already have a `User` model, which maps to the `users` table in the database.
The model is found in `app/models/user.rb`.

#### Querying the Database
Let's quickly run through some basic ways of querying the database. We'll do this by example.
Say you wanted to fetch the first User in the database, or within some list of users. Rails provides a
function called `.first` for our convenience.

```ruby
user = User.first
user.email # => "test@platterz.ca"
user.password # => nil
user.password_digest # => "$2a$10$..."
```

If we wanted to fetch a specific User by their Primary Key (in most cases, the ID column), we use `.find(...)`.
This fetches a specific record by its defined primary key, or throws an exception if it can't find the record.

```ruby
User.find(1)    # => #<User id: 1, ...>
User.find(1000) # => ActiveRecord::RecordNotFound: Couldn't find User with 'id'=1000
```

Sometimes, we might want to find a User by a column other that the ID. The Rails function `.find_by(...)` accepts
a Hash which contains columns and their associated values, and then tries to fetch a record that matches these
specified constraints. Unlike `.find(...)`, this function returns `nil` if the record isn't found.

```ruby
User.find_by(email: 'test@platterz.ca') # => #<User id: 1, ...>
User.find_by(email: 'fake') # => nil
```

If you wanted to match the behaviour of `.find(...)` and throw a error, the `.find_by!(...)` function behaves the
same way as its normal counterpart `.find_by(...)`, but throws an error if no record is found matching the
requested criteria.

```ruby
User.find_by!(email: 'test@platterz.ca') # => #<User id: 1, ...>
User.find_by!(email: 'fake') # => ActiveRecord::RecordNotFound: Couldn't find User
```

For more information about the Query Interface, and examples of how to use it:
http://guides.rubyonrails.org/active_record_querying.html#retrieving-objects-from-the-database

#### Creating Records
To create a new User record, we can just construct it like as normal Ruby object, passing attributes
we want to set as a Hash. To persist the change to the database, we call `.save`.

```ruby
user = User.new(email: 'foo@bar.ca', password: 'password')
user.save # => true
```

The `.save` method runs validations on the model, and then saves it to the database. If either part of the process
fails, it returns `false`. You can also use the `.save!` method, which behaves similarly, but raises an error instead
of returning a flag.

```ruby
user = User.new(email: '', password: 'password')
user.save! # => ActiveRecord::RecordInvalid: Validation failed: Email can't be blank
```

We can also use the `.create` method, which encapsulates both construction and saving the record in single call:

```ruby
user = User.create(email: 'foo@bar.ca', password: 'password')
```

Similarly, we also have access to `.create!`, which raises an error if the create action fails:

```ruby
User.create!(email: '', password: 'password') # => ActiveRecord::RecordInvalid: Validation failed: Email can't be blank
```

For more examples: http://guides.rubyonrails.org/active_record_basics.html#create

#### Updating Records
Updating an existing record in database works similarly. Attributes can be assigned like any normal attribute
on a Ruby object, and any changes made are saved to the database with `.save`.

```ruby
user = User.find(1)
user.email = 'foo-bar@platterz.ca'
user.save
```

We can also use the `.update` method, which assigns attributes from a Hash and saves changes in a single call:

```ruby
user = User.last
user.update(email: 'foo-bar@platterz.ca')
```

Similarly, we also have access to `.update!`, which raises an error if the update action fails:

```ruby
user = User.last
user.update!(email: '') # => ActiveRecord::RecordInvalid: Validation failed: Email can't be blank
```

For more examples: http://guides.rubyonrails.org/active_record_basics.html#update

#### Deleting Records
Deleting a record in pretty straight forward:

```ruby
user = User.last
user.destroy
```

There's also the option to use `.destroy!`, which behaves like normal, but raises an error is the action fails:

```ruby
user = User.last
user.destroy!
```

For more examples: http://guides.rubyonrails.org/active_record_basics.html#delete

## Rubocop (The Linter)
At Platterz, we use Rubocop as our linting tool for Ruby. If you're not familiar with linters or Rubocop, it
automatically checks that code conforms to our style guide. This includes things like method length, class length,
naming, whitespace and indentation, some Rails specific conventions, and general best practices.
This isn't a catch-all solution, but it's a good base-line for what you should or should not do.

To run Rubocop from your terminal, you can use:

```bash
rubocop
```

Rubocop can also automatically correct some violations (usually things related to whitespace and indentation).
To automatically correct any style issues that are encountered, pass the `-a` flag:

```bash
rubocop -a
```

Rubocop also accepts file paths, so if we wanted to only clean up the `Task` model:

```bash
rubocop -a app/models/task.rb
```

**NOTE:** Remember to look over any corrections that Rubocop does before you commit them! Sometimes,
it may choose to indent or align things in some pretty wonky ways. If you're ever in doubt,
poke someone about what Rubocop is telling you to do, and we'll steer you in the right direction.

# Chapter 0 - Checklist
Here's a checklist of things that you should've covered by the time you've finished with this chapter:

- [ ] Install dependencies with Bundler (`bundle install`).
- [ ] Create, prepare, and seed the development database.
- [ ] Run the Rails server and interactive console.
- [ ] View, Create, Update, and Destroy records.
- [ ] Run `rubocop`, the linter.

| [Back to Intro](../README.md) | [Chapter 2 &rarr;](./Chapter%201%20-%20Models.md) |
| --:| --:|
